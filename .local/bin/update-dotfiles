#!/bin/bash
set -e

# Colors for output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Helper functions
log_info() { echo -e "${BLUE}[INFO]${NC} $1"; }
log_success() { echo -e "${GREEN}[SUCCESS]${NC} $1"; }
log_warning() { echo -e "${YELLOW}[WARNING]${NC} $1"; }

main() {
    log_info "üîÑ Updating development environment..."

    # Update dotfiles repository
    update_dotfiles

    # Update Homebrew packages
    update_homebrew

    # Update mise tools
    update_mise_tools

    # Update tmux plugins
    update_tmux_plugins

    log_success "üéâ Environment updated successfully!"
}

update_dotfiles() {
    log_info "üì• Updating dotfiles..."
    dotfiles pull
    log_success "‚úÖ Dotfiles updated"
}

update_homebrew() {
    log_info "üç∫ Updating Homebrew packages..."
    brew update
    brew upgrade
    brew bundle --file="$HOME/.Brewfile" --cleanup
    log_success "‚úÖ Homebrew packages updated"
}

update_mise_tools() {
    if command -v mise >/dev/null 2>&1; then
        log_info "üîß Updating development tools..."
        mise upgrade
        log_success "‚úÖ Development tools updated"
    else
        log_warning "‚ö†Ô∏è  mise not found, skipping tool updates"
    fi
}

update_tmux_plugins() {
    if command -v tmux >/dev/null 2>&1 && [[ -d "$HOME/.config/tmux/plugins/tpm" ]]; then
        log_info "üñ•Ô∏è  Updating tmux plugins..."
        ~/.config/tmux/plugins/tpm/bin/update_plugins all
        log_success "‚úÖ tmux plugins updated"
    else
        log_warning "‚ö†Ô∏è  tmux or tpm not found, skipping plugin updates"
    fi
}

# Run main function
main "$@"